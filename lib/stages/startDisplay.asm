.segment "CODE_2"
startDisplayNametable:
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 1
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 1
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 2
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 3
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 15
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $00, $01, $02, $03, $04, $05, $06, $07, $08, $09, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 16
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 17
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 18
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 19
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 20
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $30, $31, $32, $33, $34, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 21
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $35, $36, $31, $37, $36, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 22
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 4
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 5
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 6
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ;
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 8
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 9
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F,  $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 10
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F,  $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 11
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 12
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 13
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 14
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 23
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 24
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 25
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 26
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 27
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 28
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 29
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 30
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 31
      .byt $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F ; 32

startDisplayAttributeTable:
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; !
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 2
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 3
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 4
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 5
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 6
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 8
    .byt $00, $00, $00, $00, $00, $00, $00, $00 ; 8

paleteStartDisplay:
            ; 00                        01              10              11
  .byt $0f,$10,$2a,$32,  $31,$1D,$27,$37,  $10,$1D,$27,$10,  $31,$3F,$0f,$0f   ;;background
  .byt $32,$36,$1A,$32,  $32,$36,$17,$0F,  $10,$30,$21,$0F,  $32,$29,$05,$01   ;;sprite palette

.segment "CODE"

.proc startDisplayState
    JSR handleStartButton

    RTS
.endproc

.proc loadDisplayStart
    LDA #%00000001
    STA isLoadedFlags
    JSR setHorizontalMirror
    ; change prg bank
    LDA #%00000001
    JSR setPrgBank
    ; change chr bank
    LDA #%00000100
    JSR changeChrZerro
    ; load background
    JSR loadStartDisplayBackground
    JSR loadBackground
    JSR loadPaleteStartDisplay
    JSR loadStartDisplayAttribute

    RTS
.endproc

.proc loadStartDisplayBackground
    LDA #<startDisplayNametable
    STA mapLoByte       ; put the low byte of the address of background into pointer
    LDA #>startDisplayNametable
    STA mapHiByte       ; put the high byte of the address into pointer

    RTS
.endproc

.proc loadStartDisplayAttribute
  LoadAttributePage1:
    lda $2002
    lda #$23
    sta $2006
    lda #$C0
    sta $2006

    ldx #00
  AttributePage1Loop:
    lda attributeTableLevel2Page1, x
    sta $2007
    inx
    cpx #66
    bne AttributePage1Loop

  LoadAttributePage2:
    lda $2002
    lda #$27
    sta $2006
    lda #$C0
    sta $2006

    ldx #00
  AttributePage2Loop:
    lda attributeTableLevel2Page1, x
    sta $2007
    inx
    cpx #66
    bne AttributePage2Loop

    RTS
.endproc

.proc loadPaleteStartDisplay
  LoadPalettes:
    LDA $2002
    LDA #$3F
    STA $2006             ; говорим ppu что нам необходим адрес 3F00 здесь храниться палитра
    LDA #$0F
    STA $2006             ; Сначала старший байт записываем 3F потом младший 00 при записи этот адрес будет автоматически увеличиваться

    LDX #$20              ; X = 0
  LoadPalettesLoop:
    LDA paleteStartDisplay, x
    STA $2007             ; записываем в ppu по факту в адрес 3F00
    DEX                   ; X = X + 1
    BNE LoadPalettesLoop

    RTS
.endproc

.proc handleStartButton
    LDX joyState
    CPX #%00001000
    BEQ stateStageOne
    BNE return
stateStageOne:
    JSR setVerticalMirror
    LDA #01
    STA stageStates
    JSR resetStageTwo
return:
    RTS
.endproc